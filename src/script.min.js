/**
 * @author: Kapil Kashyap
 */
import e from"../assets/data/predefined-maze-coordinates.js";!function(){let t,s,n=3,o=3,i="north",l=i,r,a=0,c,u,d,f,h,p=[],L,m,y,v,$=["classic","challenge","maze"],g=$[0],E,_,A,S,b=e["12x12"],w,T=[],q=[],P=[],M=[],O=[],N,C,R,k=0,I,U=document.querySelector(".game-indicator .progress-bar"),B=1,z=document.querySelector(".level>.value"),K=!1,x=0,D=document.querySelector(".score>.value"),G=!!/Android|webOS|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)&&(/iPad/i.test(navigator.userAgent)?document.body.style.zoom="175%":document.body.style.zoom="200%",document.body.classList.add("portable-device"),!0),V={START:G?"Press play button to start.":"Press space bar to start.",RESET:G?"Press reset button.":"Press 'R' to reset.",PAUSE:G?"":"Press space bar to pause.",RESUME:G?"Press play button to resume.":"Press space bar to resume.",LIVES_REMAINING:"lives remaining!",LIFE_REMAINING:"life remaining!",GAME_OVER:"Game over!",CONGRATULATIONS:"Congratulations",LEVEL_UNLOCKED:"level unlocked!",AMAZING:"Amazing",ALL_LEVELS_COMPLETED:"all levels completed!",TOP_3_SCORES:"Your top 3 scores will appear here...",PLAY_BUTTON_LABEL:"Play",PAUSE_BUTTON_LABEL:"Pause",DISCLAIMER:"Works best on desktop.",EXCLAMATION:"!",COMMA:", ",SPACE:" "},W=function(){let e=document.querySelector(".game-arena-display"),t=e.getBoundingClientRect(),s=e.querySelector("div"),n=ei(s),o=document.createElement("DIV"),i=null,l=1,r=1;c=Math.floor(t.height/n.height),d=(u=Math.floor(t.width/n.width))*c,p=[0,u],s.remove();for(let a=0;a<d;a++)r=a%u+1,a>=u&&1===r&&l++,(i=o.cloneNode()).setAttribute("data",[l,r]),i.setAttribute("class","empty rc_"+l+"_"+r),e.appendChild(i);e2(p),e$(),C=eE(),eL(V.START),Y()},Y=function(){document.querySelectorAll(".life .value span").forEach(function(e){e.innerHTML="&#9829;"}),document.addEventListener("keydown",function(e){e.stopPropagation(),e.preventDefault(),"ArrowUp"===e.code||"KeyW"===e.code?e.shiftKey&&("east"===l||"west"===l)?H(["north",l]):e.ctrlKey&&("east"===l||"west"===l)?H(["north","east"===l?"west":"east"]):j("north"):"ArrowRight"===e.code||"KeyD"===e.code?e.shiftKey&&("north"===l||"south"===l)?H(["east",l]):e.ctrlKey&&("north"===l||"south"===l)?H(["east","north"===l?"south":"north"]):j("east"):"ArrowDown"===e.code||"KeyS"===e.code?e.shiftKey&&("east"===l||"west"===l)?H(["south",l]):e.ctrlKey&&("east"===l||"west"===l)?H(["south","east"===l?"west":"east"]):j("south"):"ArrowLeft"===e.code||"KeyA"===e.code?e.shiftKey&&("north"===l||"south"===l)?H(["west",l]):e.ctrlKey&&("north"===l||"south"===l)?H(["west","north"===l?"south":"north"]):j("west"):"Space"===e.code&&("stopped"===N||void 0===N)?F():"Space"===e.code&&"over"!==N?X():"KeyR"===e.code&&void 0===E&&Z()}),G&&(document.querySelector(".gamepad").classList.remove("hide"),document.querySelector(".game-actions").classList.remove("hide")),em(),document.querySelector(".game-actions .play-pause").addEventListener("touchstart",function(e){e.stopPropagation(),e.preventDefault(),ey(),"stopped"===N||void 0===N?F():"over"!==N&&X()},{passive:!1}),document.querySelector(".game-actions .reset").addEventListener("touchstart",function(e){e.stopPropagation(),e.preventDefault(),!this.querySelector("button").disabled&&void 0===E&&Z()},{passive:!1}),window.addEventListener("blur",function(){"play"===N&&X()},{passive:!1})},H=function(e){"play"===N&&(O.unshift(e[0]),O.unshift(e[1]))},j=function(e){"play"===N&&O[0]!==e&&("north"===e&&"south"!==O[0]&&"south"!==l?O.unshift(e):"east"===e&&"west"!==O[0]&&"west"!==l?O.unshift(e):"south"===e&&"north"!==O[0]&&"north"!==l?O.unshift(e):"west"===e&&"east"!==O[0]&&"east"!==l&&O.unshift(e))},F=function(){eT(),e_(+ez("selected"+eo(g)+"Level")||1),e$(),es(),en(),void 0===N&&(ep(!0),e1()),ec(),ee("play"),eL(V.PAUSE),eq(),G&&em(V.PAUSE_BUTTON_LABEL)},X=function(){"paused"!==N&&"lifeLost"!==N?(clearInterval(E),clearInterval(_),clearInterval(A),clearInterval(S),ee("paused"),eL(V.RESUME),G&&(em(V.PLAY_BUTTON_LABEL),ey(!1))):("paused"===N||"lifeLost"===N)&&(ef(),"lifeLost"===N&&(ea()||eb(),J(),e1()),es(),en(),ee("play"),eL(V.PAUSE),G&&(em(V.PAUSE_BUTTON_LABEL),ey()))},Z=function(){ee("over"),eb(),ep(),J(),eL(V.START),eq(!1),ts(),G&&(ev("play-pause"),em(V.PLAY_BUTTON_LABEL),ey()),ef(),e8()},J=function(){eT(),E=void 0,clearInterval(S),P=[],"over"===N?(ee(),o=3,ec(),x=0,D.innerText=x,e$()):!ea()&&a<T.length+q.length&&ec(T.length+q.length),document.querySelectorAll(".flicker").forEach(function(e){eN(e,"flicker")}),document.querySelectorAll(".food").forEach(function(e){eN(e,"food")})},Q=function(e){l=e||i},ee=function(e){N=e},et=function(e){if(e===r)return;let n=null;"north"===e?n="east"===r?"se":"west"===r?"sw":null:"east"===e?n="south"===r?"sw":"north"===r?"nw":null:"south"===e?n="east"===r?"ne":"west"===r?"nw":null:"west"===e&&(n="south"===r?"se":"north"===r?"ne":null),n&&eO([t,s],n)},es=function(e){clearInterval(E),E=setInterval(function(){O.length>0&&(r=l,Q(O.pop()),et(l)),eJ()},e||h)},en=function(){A=setInterval(function(){x+=B*o,D.innerText=x},100)},eo=function(e){return e[0].toUpperCase()+e.slice(1)},ei=function(e){let t=getComputedStyle(e),s=parseFloat(t.marginLeft)+parseFloat(t.marginRight)+parseFloat(t.borderLeftWidth)+parseFloat(t.borderRightWidth)+parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)+parseFloat(t.width),n=parseFloat(t.marginTop)+parseFloat(t.marginBottom)+parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth)+parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)+parseFloat(t.height);return{width:s,height:n}},el=function(){return"classic"===g},er=function(){return"challenge"===g},ea=function(){return"maze"===g},ec=function(e){a=n=e||eu()},eu=function(){return el()?1===B?3:C*(B-1):10+B},ed=function(e){x+=(e||10)*B},ef=function(){document.querySelectorAll(".game-arena-display div.trail").forEach(function(e){e.classList.remove("trail")})},eh=function(){document.querySelector("span.available:nth-of-type("+o--+")").classList.remove("available")},ep=function(e){document.querySelectorAll("span").forEach(function(t){t.classList[e?"add":"remove"]("available")})},eL=function(e){document.querySelector("div.message").innerHTML=e||""},em=function(e){document.querySelector(".button.play-pause button").innerHTML=e||V.PLAY_BUTTON_LABEL},ey=function(e){e=void 0===e,document.querySelector(".button.reset button").disabled=e},ev=function(e,t){document.querySelector(".button."+e).classList[t?"add":"remove"]("hide")},e$=function(){h=eg()},eg=function(e){return(e=e||B,er())?340-20*e:ea()?440-24*e:440-40*e+(e>=9?20*(e-8):0)},eE=function(){return Math.round(Math.cbrt(v*y))},e_=function(e){B=e,z.innerText=e},eA=function(){let e,t=1;for(;e=eg(t),(!er()||100!==e)&&(!ea()||152!==e)&&(!el()||40!==e);t++){}R=t},eS=function(){if(el())I=100/(R*C);else if(er()){let e=eV();I=100/Math.pow(e[1]-e[0],2)}else ea()&&(I=100/document.querySelectorAll(".maze-path").length)},eb=function(){T.concat(q).forEach(function(e){eR(e)}),setTimeout(function(){T=[],q=[]},0)},ew=function(){t=v,s=m,Q(i),O=[]},eT=function(){if(ea()){let e,n;t=+(n=(e="lifeLost"===N?document.querySelector(".maze-path.head"):document.querySelector(".maze-path.begin")).getAttribute("data").split(","))[0],s=+n[1],Q(e.getAttribute("direction")),"north"===l?t++:"south"===l?t--:"east"===l?s--:"west"===l&&s++,e.classList.remove("nw","ne","se","sw","nw-ne","ne-se","se-sw","sw-nw")}else ew()},eq=function(e){e=void 0===e||e,document.querySelector(".instructions").classList.remove("show","hide"),document.querySelector(".instructions").classList.add(e?"hide":"show"),e||e6()},eP=function(e){return e&&document.querySelector(".rc_"+e[0]+"_"+e[1])},eM=function(e){for(let t=1;t<=u;t++)eO([e[0],t],"crosshair");for(let s=1;s<=c;s++)eO([s,e[1]],"crosshair")},e8=function(){document.querySelectorAll(".crosshair").forEach(function(e){e.classList.remove("crosshair"),el()&&e.classList.add("empty")})},eO=function(e,t){let s=eP(e);s&&("[object Array]"===Object.prototype.toString.call(t)?t.forEach(function(e){s.classList.add(e)}):s.classList.add(t),s.classList.remove("empty"))},eN=function(e,t){e&&("[object Array]"===Object.prototype.toString.call(t)?t.forEach(function(t){e.classList.remove(t)}):e.classList.remove(t),e.classList.add("empty"))},eC=function(e,t){eN(eP(e),t)},eR=function(e){if(void 0!==e){let t=eP(e);if(t){let s=t.classList.contains("tail");t.classList.remove("path","head","body","tail","trail","nw","ne","se","sw","nw-ne","ne-se","se-sw","sw-nw"),t.classList.add("empty"),!ea()&&s&&"play"===N&&t.classList.add("trail")}}},ek=function(){for(let e,t=0;t<T.length;t++)if((e=eP(T[t]))&&(e.classList.remove("empty","head","body","trail","nw-ne","ne-se","se-sw","sw-nw"),e.classList.add("path",t===T.length-1?"head":"body"),0===t&&e.classList.add("tail"),t===T.length-1)){let s="";"north"===l?s="nw-ne":"east"===l?s="ne-se":"south"===l?s="se-sw":"west"===l&&(s="sw-nw"),e.classList.add(s)}},eI=function(e,t){let s=eP(e);return!!s&&(ea()?s.classList.contains(t):!s.classList.contains(t))},eU=function(e){let t=eP(e);return!(t&&ea())||t.classList.contains("maze-path")},eB=function(e,t){localStorage.setItem(e,t)},ez=function(e){return localStorage.getItem(e)},e1=function(){if(ea())return;let e=document.querySelectorAll(".game-arena-display div.empty:not(.head)");if(e.length>0){let t=e[Math.floor(Math.random()*e.length)].getAttribute("data").split(","),s=[+t[0],+t[1]];P.push(s.toString()),eO(s,"food"),e8(),eM(s)}},e5=function(e){e=e||6;let t=document.querySelectorAll(".path");S=setInterval(function(){if(-1===e){clearInterval(S);return}t.forEach(function(t){t.classList[e%2==0?"add":"remove"]("flicker")}),e--},200)},e0=function(e){"paused"!==N&&(clearInterval(E),ee("paused"));let t=setInterval(function(){es(),ee("play"),clearInterval(t)},e||1500)},eK=function(){let e=ez("snake-game-stats"),t=+ez("unlocked"+eo(g)+"Levels")||1,s={timestamp:new Date().getTime(),level:B,score:x,selectedMode:g};if(null!==e){let n=(e=JSON.parse(e)).findIndex(function(e){return e.score<x});-1!==n?e.splice(n,0,s):e.push(s),eB("snake-game-stats",JSON.stringify(e))}else eB("snake-game-stats",JSON.stringify([s]));(el()&&B>t||K)&&(K=!1,!el()&&B++,eB("unlocked"+eo(g)+"Levels",B)),eX()},ex=function(){return w=b[(+ez("selected"+eo(g)+"Level")||1)-1]},eD=function(){document.querySelectorAll(".maze-mode .maze-path").forEach(function(e){e.removeAttribute("direction"),e.classList.remove("maze-path","north","south","east","west","begin","end")}),document.querySelector(".game-arena-display").classList.remove("maze-mode")},eG=function(e){eD(),document.querySelector(".game-arena-display").classList.add("maze-mode"),e=e||c,ex();let t=e/Math.sqrt(w.length),s,n,o,i,l,r,a,u,d,f="maze-path",h=w.length,p=function(e){return Math.round((e+1)*t-1)};w.forEach(function(e,c){if(n="",i=eP([r=p(e[0]),a=p(e[1])]),s){s[0]>e[0]?n="north":s[0]<e[0]&&(n="south"),s[1]>e[1]?n="west":s[1]<e[1]&&(n="east"),u=p(s[0]),d=p(s[1]);for(let L=1;L<t;L++)"north"===n?u--:"south"===n?u++:"east"===n?d++:"west"===n&&d--,(l=eP([u,d])).classList.add(f,n),l.setAttribute("direction",n);o.classList.add(f),i.classList.add(f,n),o.setAttribute("direction",n),1===c&&o.classList.add(n)}else i.classList.add(f,"begin");h===c+1&&i.classList.add("end",f),s=e,o=i})},eV=function(){let e=+ez("selected"+eo(g)+"Level")||1,t,s=document.querySelector("body").classList.contains("dark");return f=Math.pow((t=e<=3?s?[12,28]:[9,27]:e>3&&e<=6?s?[10,30]:[6,30]:e>6&&e<=9?s?[5,35]:[3,33]:s?[0,40]:[0,36]).reduce((e,t)=>t-e),2),t},e2=function(e){L=e[0]+1,m=e[0]+1,y=e[1],v=e[1],ew()},eW=function(e){e=e||eV(),e3(),e2(e),document.querySelector(".game-arena-display").classList.add("challenge-mode"),document.querySelectorAll(".empty").forEach(function(t){let s=t.getAttribute("data").split(",");(+s[0]<=e[0]||+s[0]>e[1]||+s[1]<=e[0]||+s[1]>e[1])&&(t.classList.remove("empty"),t.classList.add("danger"))})},e3=function(){e2(p),document.querySelectorAll(".danger").forEach(function(e){e.classList.remove("danger"),e.classList.add("empty")}),document.querySelector(".game-arena-display").classList.remove("challenge-mode")},eY=function(e){e.stopPropagation(),document.querySelector(".modes div.selected").classList.remove("selected"),this.classList.add("selected"),eB("selectedMode",g=this.getAttribute("data")),eA(),e4(),ej(),e6(),eF(),ea()?eG():eD(),er()?eW():e3(),ec(),eX(),eS(),ts()},e7=function(e){e.stopPropagation(),document.querySelector(".levels div.selected").classList.remove("selected"),this.classList.add("selected");let t=+this.getAttribute("data");eB("selected"+eo(g)+"Level",t),ea()&&eG(),er()&&eW(),ec()},eH=function(){let e=JSON.parse(ez("unlockedModes"))||[g];g=ez("selectedMode")||g,document.querySelectorAll(".selectMode .modes .mode").forEach(function(t){let s=t.getAttribute("data");t.removeEventListener(G?"touchstart":"click",eY),t.classList.remove("selected","enabled","disabled"),t.addEventListener(G?"touchstart":"click",eY),s===g?t.classList.add("enabled","selected"):-1===e.indexOf(s.toLowerCase())?(t.classList.add("disabled"),t.removeEventListener(G?"touchstart":"click",eY)):t.classList.add("enabled")}),ea()?eG():er()&&eW()},e4=function(){document.querySelectorAll(".selectLevel .levels .level").forEach(function(e){e.remove()})},ej=function(){let e=document.querySelector(".selectLevel .levels"),t=document.createElement("DIV"),s;for(let n=1;n<=R;n++)(s=t.cloneNode()).setAttribute("data",n),s.setAttribute("class","level"),s.innerText=n,e.appendChild(s)},e6=function(){let e=+ez("selected"+eo(g)+"Level")||1,t=+ez("unlocked"+eo(g)+"Levels")||1;document.querySelectorAll(".selectLevel .levels .level").forEach(function(s,n){s.removeEventListener(G?"touchstart":"click",e7),s.classList.remove("selected","enabled","disabled"),s.addEventListener(G?"touchstart":"click",e7),e===n+1?s.classList.add("enabled","selected"):t<n+1?(s.classList.add("disabled"),s.removeEventListener(G?"touchstart":"click",e7)):s.classList.add("enabled")})},eF=function(){document.querySelectorAll(".instructions .details ol").forEach(function(e){e.classList.contains(g+"-mode")?(e.classList.add("show"),e.classList.remove("hide")):(e.classList.remove("show"),e.classList.contains("hide")||e.classList.add("hide"))})},eX=function(e){e=e||3;let t=document.querySelector(".leaderboard"),s=JSON.parse(ez("snake-game-stats"));if(null!==s&&(s=s.filter(function(e){return e.selectedMode===g})),s&&s.length>0){let n=Object.keys(s[0]),o="<div class='row'>";o+="<div class='column head'>S.No</div>",n.forEach(function(e){"timestamp"!==e&&"time"!==e&&(o+="<div class='column head'>"+e+"</div>")}),o+="</div>";for(let i,l=0;l<e;l++)(i=s[l])&&(o+="<div class='row'>",o+="<div class='column'>"+(l+1)+".</div>",n.forEach(function(e){"timestamp"!==e&&"time"!==e&&(o+="<div class='column'>"+i[e]+"</div>")}),o+="</div>");t.innerHTML=o}else t.innerHTML="<div class='message'>"+V.TOP_3_SCORES+"</div>"},eZ=function(e,t,s){s=void 0!==s&&s,clearInterval(E),clearInterval(_),clearInterval(A),e5(e),ea()&&document.querySelector(".maze-mode .head").classList.contains("end")&&(s=!0,t=eQ(),eK()),!s&&o>1?(eh(),ee("lifeLost"),eL(o+V.SPACE+(1===o?V.LIFE_REMAINING:V.LIVES_REMAINING)+V.SPACE+V.RESUME),em(V.PLAY_BUTTON_LABEL)):(ee("over"),ep(),eL(t||V.GAME_OVER+V.SPACE+V.RESET),G&&ev("play-pause",!0),ea()||eK()),G&&ey(!1)},eJ=function(){let e=ea()?"maze-path":"body";if("north"===l){if(T.length<n){if(t>L&&eU([t-1,s]))T.length>0?T.push([--t,s]):(t-=t===v?0:1,T.push([t,s]));else{eZ(7);return}if(eI([t,s],e))eR(q.shift()),ek();else{eZ(7);return}}else if(q.push(T.shift()),t>L&&eI([t-1,s],e)){if(T.push([--t,s]),eI([t,s],e))eR(q.shift()),ek();else{eZ(7);return}}else{eZ(7);return}}else if("south"===l){if(T.length<n){if(t<v&&eU([t+1,s]))T.length>0?T.push([++t,s]):(t+=t===v?0:1,T.push([t,s]));else{eZ(7);return}if(eI([t,s],e))eR(q.shift()),ek();else{eZ(7);return}}else if(q.push(T.shift()),t<v&&eI([t+1,s],e)){if(T.push([++t,s]),eI([t,s],e))eR(q.shift()),ek();else{eZ(7);return}}else{eZ(7);return}}else if("east"===l){if(T.length<n){if(s<y&&eU([t,s+1]))T.length>0?T.push([t,++s]):(s+=s===y?0:1,T.push([t,s]));else{eZ(7);return}if(eI([t,s],e))eR(q.shift()),ek();else{eZ(7);return}}else if(q.push(T.shift()),s<y&&eI([t,s+1],e)){if(T.push([t,++s]),eI([t,s],e))eR(q.shift()),ek();else{eZ(7);return}}else{eZ(7);return}}else if("west"===l){if(T.length<n){if(s>m&&eU([t,s-1]))T.length>0?T.push([t,--s]):(s-=s===m?0:1,T.push([t,s]));else{eZ(7);return}if(eI([t,s],e))eR(q.shift()),ek();else{eZ(7);return}}else if(q.push(T.shift()),s>m&&eI([t,s-1],e)){if(T.push([t,--s]),eI([t,s],e))eR(q.shift()),ek();else{eZ(7);return}}else{eZ(7);return}}te(),tt(),ea()&&k++,er()&&document.querySelectorAll(".game-arena-display div.path").length===f&&eZ(10,eQ(),!0)},eQ=function(){let e,t=+ez("selected"+eo(g)+"Level")||1,s=+ez("unlocked"+eo(g)+"Levels")||1;return t===s&&t<R?(e=V.CONGRATULATIONS+V.COMMA+V.LEVEL_UNLOCKED+V.SPACE+V.RESET,K=!0):e=t<s?V.CONGRATULATIONS+V.EXCLAMATION+V.SPACE+V.RESET:V.AMAZING+V.COMMA+V.ALL_LEVELS_COMPLETED+V.SPACE+V.RESET,e},e9=function(){let e=document.querySelector(".level .value"),t=1.9,s=setInterval(function(){t+=.1,e.style.background="repeating-radial-gradient(orange, transparent "+t+"px)",t>15&&(e.style.background="",clearInterval(s))},20)},te=function(){let e,i,l=[t,s];if(-1!==(e=P.indexOf(l.toString()))){P.splice(e,1),eC(l,"food"),ed(),e1(),n+=er()?5:1,el()&&n%C==0&&(z.innerText=++B,e$(),el()&&h<40&&(B--,eZ(10,"Well done! :)",!0),document.querySelectorAll(".food").forEach(function(e){eN(e,"food")}),1)?z.innerText=B:(e0(100),e9()));return}-1!==(i=M.indexOf(l.toString()))&&(eh(),M.splice(i,1),eC(l,"danger"),e5(),e0(),0===o&&eZ())},tt=function(){if(U.style.borderColor="#00ff0d",U.style.background="#00ff0d",el()&&n>3){U.style.width=I*n+"%";return}if(er()){U.style.width=I*document.querySelectorAll(".game-arena-display div.path").length+"%";return}ea()&&(U.style.width=I*k+"%")},ts=function(){U.style.width="0px",U.style.borderColor="transparent",U.style.background="transparent",ea()&&(k=0)},tn,to,ti;eB("unlockedModes",JSON.stringify(["classic","challenge","maze"])),g=ez("selectedMode")||g,e_(+ez("selected"+eo(g)+"Level")||1),eA(),ec(),W(),tn=document.querySelector(".selectMode .modes"),to=document.createElement("DIV"),$.forEach(function(e){(ti=to.cloneNode()).setAttribute("data",e),ti.setAttribute("class","mode"),ti.innerText=e,tn.appendChild(ti)}),eH(),ej(),e6(),eF(),eX(),eS()}();